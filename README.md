# Прототип. 2020-11-01
# Сбор данных по запросу полученному "Сетью университетских центров сбора и анализа открытых данных"
## Группа: ИРНИТУ 109P

Для запуска веб-приложения, его необходимо развернуть используя docker.

## Функции
* Импорт данных из VK.
* Работа с предзагруженными данными.
* Визуализация.

# Разработка
MVP модуля сбора данных из социальной сети VK.com
* *прототип представлен в файле `prototype.ipynb`*

## Как работает модуль:
1. Модуль, представляет собой веб-приложение, которое запрашивает id паблика в VK. Для тестирования использовался - [Паблик «Батутный центр города Томска»](https://vk.com/club95095088)
2. Данные запрашиваются через API-VK, для работы требуется ключ.
3. Данные сохраняются в БД MongoDB.
4. Строятся простые визуалазации данных.
5. Данные сибираются и доступны для исследователей входящих в сеть «Университетских центров».

## Техническая реализация
* Модуль построен на python на основе следующих библиотек: `numpy pandas matplotlib seaborn requests pymongo django pymorphy2`
* Развертывание осуществляось через Docker.
* Модуль развёрнут в Google Cloud.

## Docker
* Базовый образ - [python](https://hub.docker.com/_/python/)

## ❗ Краткое описание процесса разработки и инструкции по по самостоятельному развёртыванию
1. Создаём виртуальное окружение `conda create --name vkmdb python=3.7 ipykernel numpy pandas matplotlib seaborn requests pymongo django pymorphy2 notebook ipywidgets`
2. Запускаем MongoDB - локально, для тестирования
```bash
docker pull mongo
docker run -d --name i109r -p 27017:27017 mongo:latest
```
3. Создаём проект Django
```bash
django-admin startproject VK2MongoDB .
```
4. Создаём приложение
```bash
python manage.py startapp main
```
5. В приложении создаём необходимые представления:
    * `home` - основная страница с описанием
    * `start` - запрос данных от пользователя и начало загрузки данных
    * `upload` - для работы с предзагруженными данными
    * `transform` - преобразования данных в БД
    * `visualization` - обзор собранных данных

6. Преобразуем прототип в отдельные скрипты, которые будут вызываться при работе приложения, разместим их в папке `main`:
    * Основные: 
        * `py_data_get.py` - модуль получения данных от VK (используется в представлениях)
        * `py_data_transorm.py` - модуль трансформации данных в БД
        * `py_visualization.py` - визуализация данных
    * Системные - получение данных:
        * `py_mongodb.py` - системный модуль для работы с базой данных
        * `py_parse.py` - системный модуль для разбора ответа от API-VK
        * `py_settings.py` - модуль с настройками (параметры заданы по умолчанию, меняются при начале работы с приложением - используется в представлениях)
        * `py_system.py` - системный модуль для внутренних проверок
        * `py_vkapi.py` - модуль взаимодействия с VKAPI
    * Системные - преобразование данных:
        * `py_datetime.py` - работа со временем
        * `py_words.py` - преобразования текста
        * `py_categories.py` - категории постов и комментариев (в разработке)
    * `py_unittest.py` - Юниттесты (работа с БД)
7. Составим dokerfile - для создания контейнера.
8. Соберём свой контейнер `docker build -t vk-mongo-parser-image:v0.1 .`
9. Создадим сеть для взаимодействия контейнеров `docker network create backend-network`
10. Запускам mongodb-server `docker run -d --name mongo-server -p 27017:27017 --net backend-network mongo`
    * `mongo-server` - нужно использовать в проекте в качестве ip адреса сервера
11. Запустим приложение `docker run -d --rm --name app -p 8000:8000 --net backend-network -e "VK_TOKEN=..." vk-mongo-parser-image:v0.1`
    * `-d` - в режиме демона
    * `--rm` - при отключение контейнер будет удалятся
    * `--name app` - название для контейнера
    * `-p 8000:8000` - привязка портов
    * `--net backend-network` - подключить к сети
    * `-e "VK_TOKEN=..."` - ваш токен из VK
12. Проведём тестирование на локальной машине.
13. Переносим созданный Docker Image в облако Google Cloud
  * `docker save -o D:\app.tar vk-mongo-parser-image:v0.1`
  * `wget 'your_link' -O app.tar` - одинарные кавычки вокруг http
  * `docker load -i app.tar`
14. Развёртываем всё в облаке.
